ç´ æ™´ã‚‰ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã­ï¼Japaneseãƒ–ãƒ©ãƒ³ãƒ‰ã¨ã—ã¦ä¸–ç•Œã«èª‡ã‚Œã‚‹æ´—ç·´ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ã«ç”Ÿã¾ã‚Œå¤‰ã‚ã‚‰ã›ã¾ã—ã‚‡ã†ã€‚ä¾˜å¯‚ã®ç¾å­¦ã¨ãƒ¢ãƒ€ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’èåˆã•ã›ãŸã€æ¯ã‚’ã®ã‚€ã‚ˆã†ãªç¾ã—ã„UIã‚’ä½œæˆã„ãŸã—ã¾ã™ã€‚

**ğŸŒ Japanese Premium Design - ONE WORLD Quiz**

ä»¥ä¸‹ãŒå®Œå…¨ã«æ´—ç·´ã•ã‚ŒãŸå®Œæˆç‰ˆã‚³ãƒ¼ãƒ‰ã§ã™ï¼š

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ONE WORLD Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+JP:wght@300;400;500;600;700;800&family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ğŸŒ Japanese Premium Color Palette */
            --primary-sakura: linear-gradient(135deg, #FFB7D5 0%, #FF8FA3 50%, #FF6B7D 100%);
            --primary-ocean: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-forest: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --primary-sunset: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --primary-midnight: linear-gradient(135deg, #2c3e50 0%, #4a6741 100%);
            
            /* Accent Colors */
            --accent-gold: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            --accent-pearl: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --accent-jade: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            
            /* Neutral Palette */
            --bg-pure: #ffffff;
            --bg-mist: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --bg-cloud: #fafbfc;
            --bg-whisper: rgba(255, 255, 255, 0.85);
            
            /* Text Colors */
            --text-ink: #2c3e50;
            --text-charcoal: #34495e;
            --text-silver: #7f8c8d;
            --text-pearl: #bdc3c7;
            
            /* Japanese Traditional Colors */
            --japanese-indigo: #1e3a8a;
            --japanese-crimson: #dc143c;
            --japanese-gold: #ffd700;
            --japanese-moss: #8fbc8f;
            
            /* Shadows & Effects */
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.12);
            --shadow-strong: 0 16px 48px rgba(0, 0, 0, 0.15);
            --shadow-glow: 0 0 32px rgba(102, 126, 234, 0.25);
            
            /* Glass Effect */
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.18);
            --glass-backdrop: blur(20px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Zen Kaku Gothic New", "Noto Sans JP", "Inter", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            color: var(--text-ink);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            padding-top: 6rem;
            padding-bottom: 3rem;
            position: relative;
        }

        /* ğŸŒ¸ Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 183, 213, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(56, 239, 125, 0.08) 0%, transparent 50%);
            animation: backgroundPulse 15s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }

        @media (min-width: 640px) {
            .container-spacing { max-width: 520px; }
        }
        @media (min-width: 768px) {
            .container-spacing { max-width: 640px; }
        }
        @media (min-width: 1024px) {
            .container-spacing { max-width: 760px; }
        }

        /* ğŸŒ Japanese Premium Title */
        .game-title {
            font-family: 'Zen Kaku Gothic New', sans-serif;
            font-weight: 700;
            font-size: clamp(1.8rem, 5vw, 3.2rem);
            background: var(--primary-sakura);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            letter-spacing: -0.025em;
            margin-bottom: 1rem;
            position: relative;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 8px rgba(255, 183, 213, 0.3)); }
            50% { filter: drop-shadow(0 0 16px rgba(255, 183, 213, 0.5)); }
        }

        /* ğŸŒŠ Glass Morphism Cards */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            -webkit-backdrop-filter: var(--glass-backdrop);
            border: 1.5px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-strong);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* ğŸ¯ Premium Buttons */
        .premium-button {
            position: relative;
            padding: 1rem 2rem;
            border: none;
            border-radius: 16px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .premium-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .premium-button:hover::before {
            left: 100%;
        }

        .premium-button:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: var(--shadow-strong);
        }

        .premium-button:active {
            transform: translateY(-2px) scale(1.02);
        }

        /* Button Variants */
        .btn-sakura {
            background: var(--primary-sakura);
            color: white;
            box-shadow: 0 8px 32px rgba(255, 183, 213, 0.4);
        }

        .btn-ocean {
            background: var(--primary-ocean);
            color: white;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
        }

        .btn-forest {
            background: var(--primary-forest);
            color: white;
            box-shadow: 0 8px 32px rgba(17, 153, 142, 0.4);
        }

        .btn-sunset {
            background: var(--primary-sunset);
            color: white;
            box-shadow: 0 8px 32px rgba(247, 112, 154, 0.4);
        }

        .btn-glass {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1.5px solid var(--glass-border);
            color: var(--text-ink);
            box-shadow: var(--shadow-soft);
        }

        /* ğŸ“ Grade Selection */
        .grade-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-ink);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            padding: 1.5rem 1rem;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
            cursor: pointer;
        }

        .grade-btn:hover {
            background: var(--primary-sakura);
            color: white;
            transform: translateY(-6px) scale(1.05);
            box-shadow: var(--shadow-strong);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .grade-btn.active {
            background: var(--primary-ocean);
            color: white;
            transform: translateY(-6px) scale(1.05);
            box-shadow: var(--shadow-glow);
        }

        /* ğŸ“š Lesson Buttons */
        .lesson-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1.5px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-ink);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            padding: 1rem 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 80px;
            box-shadow: var(--shadow-soft);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
        }

        .lesson-btn:hover {
            background: var(--primary-forest);
            color: white;
            transform: translateY(-4px) scale(1.03);
            box-shadow: var(--shadow-medium);
        }

        .lesson-btn.selected {
            background: var(--primary-ocean);
            color: white;
            transform: translateY(-4px) scale(1.03);
            box-shadow: var(--shadow-glow);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .lesson-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--japanese-indigo);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            box-shadow: var(--shadow-soft);
        }

        /* ğŸ“ Grammar Buttons */
        .grammar-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1.5px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-ink);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            padding: 0.75rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 70px;
            box-shadow: var(--shadow-soft);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
        }

        .grammar-btn:hover {
            background: var(--primary-sunset);
            color: white;
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .grammar-btn.selected {
            background: var(--primary-sakura);
            color: white;
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .grammar-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--japanese-indigo);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        /* ğŸŒ¸ Modal System */
        .modal {
            display: none;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 0 !important;
            margin: 0 !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            -webkit-overflow-scrolling: touch !important;
        }

        .modal.show {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: flex-start !important;
            padding-top: 8rem !important;
            padding-bottom: 6rem !important;
            animation: modalSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-content {
            width: 100% !important;
            max-width: 600px !important;
            margin: 1rem !important;
            margin-bottom: 3rem !important;
            position: static !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
        }

        /* ğŸŒ Premium Header */
        .premium-header {
            position: fixed;
            top: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            z-index: 1001;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1.5px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--shadow-medium);
            animation: headerFloat 4s ease-in-out infinite;
            max-width: 90vw;
            overflow: hidden;
        }

        @keyframes headerFloat {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-4px); }
        }

        .header-stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--glass-bg);
            border: 1.5px solid var(--glass-border);
            border-radius: 16px;
            padding: 0.5rem 0.75rem;
            min-width: 70px;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-soft);
        }

        .header-stat-item:hover {
            transform: translateY(-3px) scale(1.08);
            box-shadow: var(--shadow-medium);
            background: var(--primary-ocean);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .header-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-medium);
        }

        .header-nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .header-nav-item:hover::before {
            opacity: 1;
        }

        .header-nav-item:hover {
            transform: translateY(-6px) scale(1.15);
            box-shadow: var(--shadow-strong);
        }

        .header-nav-item.home {
            background: var(--primary-sakura);
        }

        .header-nav-item.back {
            background: var(--primary-forest);
        }

        .header-nav-item.voice {
            background: var(--primary-sunset);
        }

        /* ğŸ¯ Timer Display */
        .timer-display {
            width: 80px !important;
            height: 80px !important;
            border-radius: 50% !important;
            font-size: 1.4rem !important;
            font-weight: 800 !important;
            text-align: center !important;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
            border: 3px solid !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: var(--shadow-medium) !important;
            position: relative !important;
            overflow: hidden !important;
        }

        .timer-display::before {
            content: '' !important;
            position: absolute !important;
            top: -50% !important;
            left: -50% !important;
            width: 200% !important;
            height: 200% !important;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.5) 50%, transparent 70%) !important;
            animation: timerShine 3s linear infinite !important;
            z-index: 1 !important;
        }

        @keyframes timerShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .timer-display span {
            position: relative !important;
            z-index: 2 !important;
        }

        .timer-normal {
            background: var(--primary-forest) !important;
            color: white !important;
            border-color: #059669 !important;
        }

        .timer-warning {
            background: var(--accent-gold) !important;
            color: white !important;
            border-color: #d97706 !important;
            animation: timerPulse 1s infinite !important;
        }

        .timer-danger {
            background: var(--primary-sakura) !important;
            color: white !important;
            border-color: #dc2626 !important;
            animation: timerPulse 0.5s infinite !important;
        }

        .timer-unlimited {
            background: var(--primary-ocean) !important;
            color: white !important;
            border-color: #2563eb !important;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ğŸ¨ Quiz Components */
        .quiz-question {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            border: 2px solid var(--glass-border) !important;
            border-radius: 20px !important;
            padding: 2rem !important;
            text-align: center !important;
            font-size: 1.3rem !important;
            font-weight: 600 !important;
            color: var(--text-ink) !important;
            line-height: 1.6 !important;
            margin-bottom: 1.5rem !important;
            box-shadow: var(--shadow-medium) !important;
            position: relative !important;
            overflow: hidden !important;
        }

        .quiz-question::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: questionShimmer 3s ease-in-out infinite;
        }

        @keyframes questionShimmer {
            0%, 100% { left: -100%; }
            50% { left: 100%; }
        }

        .answer-display {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 1.5rem;
            margin-bottom: 3rem;
            text-align: left;
            font-size: 1.1rem;
            line-height: 1.8;
            box-shadow: var(--shadow-medium);
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .answer-display.show {
            border-color: rgba(17, 153, 142, 0.5);
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.05), rgba(56, 239, 125, 0.05));
            opacity: 1;
            transform: translateY(0);
        }

        .answer-text {
            font-weight: 700;
            font-size: 1.5rem;
            background: var(--primary-forest);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
            text-align: center;
            width: 100%;
            padding: 1.5rem;
            background-color: rgba(17, 153, 142, 0.1);
            border-radius: 16px;
            position: relative;
        }

        /* ğŸµ Voice & Audio Components */
        .voice-gender-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1.5rem;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 2px solid var(--glass-border);
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            min-height: 140px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            margin-bottom: 1.5rem;
        }

        .voice-gender-btn:hover {
            background: var(--primary-sunset);
            color: white;
            transform: translateY(-6px) scale(1.03);
            box-shadow: var(--shadow-strong);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .voice-gender-btn.selected {
            background: var(--primary-ocean);
            color: white;
            transform: translateY(-6px) scale(1.03);
            box-shadow: var(--shadow-glow);
        }

        .speak-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--primary-forest);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            vertical-align: middle;
            box-shadow: var(--shadow-soft);
        }

        .speak-btn:hover {
            background: var(--primary-sakura);
            transform: scale(1.2);
            box-shadow: var(--shadow-medium);
        }

        .speak-btn.speaking {
            animation: speakPulse 1s infinite;
        }

        @keyframes speakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* ğŸŒŸ Particle Effects */
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: 700;
            z-index: 100;
            animation: particleFloat 3s ease-out forwards;
            font-size: 24px;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-60px) scale(1.4) rotate(180deg);
                opacity: 0.9;
            }
            100% {
                transform: translateY(-120px) scale(1.6) rotate(360deg);
                opacity: 0;
            }
        }

        /* ğŸŠ Success Animation */
        .sparkle {
            position: relative;
            overflow: visible;
            animation: sparkleGlow 2s ease-in-out infinite;
        }

        @keyframes sparkleGlow {
            0%, 100% { text-shadow: 0 0 5px rgba(255, 183, 213, 0.5); }
            50% { text-shadow: 0 0 20px rgba(255, 183, 213, 0.8), 0 0 30px rgba(102, 126, 234, 0.4); }
        }

        .sparkle::before,
        .sparkle::after {
            content: 'âœ¨';
            position: absolute;
            opacity: 0;
            animation: sparkleFloat 4s infinite ease-in-out;
        }

        .sparkle::before {
            top: -15px;
            left: -15px;
            animation-delay: 0s;
        }

        .sparkle::after {
            bottom: -15px;
            right: -15px;
            animation-delay: 2s;
        }

        @keyframes sparkleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.8) rotate(0deg); }
            50% { opacity: 1; transform: translateY(-30px) scale(1.2) rotate(180deg); }
        }

        /* ğŸ® Game Controls */
        .control-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .control-btn {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 1.5px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-ink);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0.75rem;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
            cursor: pointer;
        }

        .control-btn:hover {
            background: var(--primary-ocean);
            color: white;
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .control-btn.active {
            background: var(--primary-sakura);
            color: white;
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        /* ğŸ“± Responsive Design */
        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }

            .glass-card {
                margin: 0.5rem;
                padding: 1.5rem;
            }

            .game-title {
                font-size: clamp(1.5rem, 6vw, 2.5rem);
            }

            .grade-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
            }

            .lesson-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .grammar-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .timer-display {
                width: 70px !important;
                height: 70px !important;
                font-size: 1.2rem !important;
            }

            .quiz-question {
                font-size: 1.1rem !important;
                padding: 1.5rem !important;
            }

            .premium-header {
                top: 1rem;
                padding: 0.75rem 1.5rem;
                gap: 1rem;
            }

            .header-nav-item {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }
        }

        /* ğŸ¯ Grid Layouts */
        .grade-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .lesson-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .grammar-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        .control-grid-2x2 {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .control-grid-1x1 {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        /* ğŸ¨ Stats Display */
        .stats-display {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-backdrop);
            border: 2px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .stats-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
            pointer-events: none;
        }

        /* ğŸŒŠ Section Divider */
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-ocean), transparent);
            margin: 2rem 0;
            border-radius: 2px;
        }

        /* ğŸ”„ Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #ddd, #ccc);
            transition: 0.4s;
            border-radius: 32px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 3px;
            bottom: 3px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked + .toggle-slider {
            background: var(--primary-forest);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(28px);
        }

        /* ğŸ¯ Action Buttons */
        .action-button-container {
            position: sticky;
            bottom: 0;
            background: linear-gradient(to top, var(--bg-pure), rgba(255, 255, 255, 0.95));
            padding: 2rem 1.5rem;
            margin: -1.5rem;
            margin-top: 2rem;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
        }

        /* ğŸŒ Remove all horizontal lines */
        *, *::before, *::after,
        *:focus, *:active, *:hover,
        *:focus-visible, *:focus-within {
            border-top: none !important;
            border-bottom: none !important;
            outline: none !important;
        }

        /* Override Tailwind borders */
        .border, .border-t, .border-b, .border-l, .border-r,
        .border-0, .border-2, .border-4, .border-8,
        .border-t-0, .border-t-2, .border-t-4, .border-t-8,
        .border-b-0, .border-b-2, .border-b-4, .border-b-8,
        .border-solid, .border-dashed, .border-dotted,
        .divide-y, .divide-x {
            border-top: none !important;
            border-bottom: none !important;
        }

        /* Restore necessary borders */
        .glass-card {
            border: 1.5px solid var(--glass-border) !important;
        }

        .grade-btn {
            border: 2px solid var(--glass-border) !important;
        }

        .lesson-btn {
            border: 1.5px solid var(--glass-border) !important;
        }

        .grammar-btn {
            border: 1.5px solid var(--glass-border) !important;
        }

        .quiz-question {
            border: 2px solid var(--glass-border) !important;
        }

        .answer-display {
            border: 2px solid var(--glass-border) !important;
        }

        .header-stat-item {
            border: 1.5px solid var(--glass-border) !important;
        }

        .header-nav-item {
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
        }

        /* Touch optimizations */
        button, .grade-btn, .lesson-btn, .grammar-btn, .premium-button, .control-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }

        * {
            touch-action: manipulation;
        }

        input, select, textarea {
            font-size: 16px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center gap-6 relative">
    <!-- ãƒ¡ã‚¤ãƒ³å­¦å¹´é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="mainGradeModal" class="modal show">
        <div class="modal-content">
            <div class="glass-card p-8 text-center">
                <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
                <h2 class="text-xl font-semibold mb-4 text-gray-700">
                    ğŸ“ å­¦å¹´ã‚’é¸æŠã—ã‚ˆã†
                </h2>
                <p class="text-gray-600 mb-6">ã‚ãªãŸã®å­¦ç¿’ãƒ¬ãƒ™ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grade-grid mb-8">
                    <button class="grade-btn premium-button" data-grade="grade1">
                        <div class="text-4xl mb-2">ğŸŒ±</div>
                        <div class="font-semibold">ä¸­å­¦1å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn premium-button" data-grade="grade2">
                        <div class="text-4xl mb-2">ğŸŒ¿</div>
                        <div class="font-semibold">ä¸­å­¦2å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn premium-button" data-grade="grade3">
                        <div class="text-4xl mb-2">ğŸŒ³</div>
                        <div class="font-semibold">ä¸­å­¦3å¹´ç”Ÿ</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦1å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade1Modal" class="modal">
        <div class="modal-content">
            <div class="glass-card p-8 text-center">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">
                    ğŸŒ± ä¸­å­¦1å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 mb-6">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-8" id="grade1Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="action-button-container">
                    <button id="startMultipleLessons1" class="premium-button btn-sakura w-full sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦2å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade2Modal" class="modal">
        <div class="modal-content">
            <div class="glass-card p-8 text-center">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">
                    ğŸŒ¿ ä¸­å­¦2å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 mb-6">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-8" id="grade2Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="action-button-container">
                    <button id="startMultipleLessons2" class="premium-button btn-sakura w-full sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦3å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade3Modal" class="modal">
        <div class="modal-content">
            <div class="glass-card p-8 text-center">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">
                    ğŸŒ³ ä¸­å­¦3å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 mb-6">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-8" id="grade3Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="action-button-container">
                    <button id="startMultipleLessons3" class="premium-button btn-sakura w-full sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡æ³•é …ç›®é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grammarModal" class="modal">
        <div class="modal-content">
            <div class="glass-card p-8 text-center">
                <h2 id="grammarModalTitle" class="text-xl font-semibold mb-4 text-gray-700"></h2>
                <p class="text-gray-600 mb-6">å­¦ç¿’ã™ã‚‹å†…å®¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grammar-grid mb-6" id="grammarCategories">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="action-button-container">
                    <button id="startGrammarQuiz" class="premium-button btn-ocean w-full sparkle" disabled>
                        ğŸš€ ã‚¯ã‚¤ã‚ºã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- éŸ³å£°è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="voiceSettingsModal" class="modal">
        <div class="modal-content">
            <div class="glass-card p-8 text-center">
                <h2 class="text-xl font-semibold mb-6 text-gray-700">
                    ğŸ¤ éŸ³å£°è¨­å®š
                </h2>
                
                <!-- éŸ³å£°ON/OFFåˆ‡ã‚Šæ›¿ãˆ -->
                <div class="voice-toggle mb-8">
                    <div class="text-lg font-semibold text-gray-700 mb-4">ğŸ”Š éŸ³å£°æ©Ÿèƒ½</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="voiceEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div class="text-sm text-gray-600 mt-3" id="voiceToggleDescription">éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™</div>
                </div>
                
                <!-- ã‚·ãƒ³ãƒ—ãƒ«éŸ³å£°é¸æŠ -->
                <div id="simpleVoiceSelection">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="action-button-container">
                    <button class="premium-button btn-forest w-full" onclick="closeVoiceSettings()">
                        âœ… è¨­å®šå®Œäº†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="hidden">
        <div class="glass-card p-8 text-center container-spacing mb-8">
            <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
            <div id="currentCategory" class="text-xl font-semibold text-gray-700 mb-6"></div>
            <div class="stats-display">
                <div class="grid grid-cols-2 gap-6 text-center mb-6">
                    <div>
                        <div class="text-3xl font-bold text-blue-600" id="studyCount">0</div>
                        <div class="text-sm text-gray-600">ğŸ“š å­¦ç¿’å›æ•°</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-purple-600" id="clickCount">0</div>
                        <div class="text-sm text-gray-600">ğŸ–±ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
                    </div>
                </div>
                
                <!-- åˆ¶é™æ™‚é–“è¨­å®š -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-lg font-semibold text-gray-700 mb-4">â° åˆ¶é™æ™‚é–“è¨­å®š</div>
                    <div class="control-grid control-grid-2x2 mb-4">
                        <button id="timer3Btn" class="control-btn active" data-time="3">
                            âš¡ 3ç§’
                        </button>
                        <button id="timer5Btn" class="control-btn" data-time="5">
                            ğŸ”¥ 5ç§’
                        </button>
                        <button id="timer10Btn" class="control-btn" data-time="10">
                            ğŸŒŸ 10ç§’
                        </button>
                        <button id="timerUnlimitedBtn" class="control-btn" data-time="unlimited">
                            âˆ ç„¡åˆ¶é™
                        </button>
                    </div>
                </div>
                
                <!-- å‡ºé¡Œå½¢å¼é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-lg font-semibold text-gray-700 mb-4">ğŸ² å‡ºé¡Œã‚¹ã‚¿ã‚¤ãƒ«</div>
                    <div class="control-grid control-grid-2x2 mb-4">
                        <button id="randomModeBtn" class="control-btn active" data-mode="random">
                            ğŸ¯ ãƒ©ãƒ³ãƒ€ãƒ 
                        </button>
                        <button id="sequentialModeBtn" class="control-btn" data-mode="sequential">
                            ğŸ“– é †ç•ªé€šã‚Š
                        </button>
                    </div>
                </div>

                <!-- å‡ºé¡Œæ–¹å‘é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-lg font-semibold text-gray-700 mb-4">ğŸŒ è¨€èªæ–¹å‘</div>
                    <div class="control-grid control-grid-2x2 mb-4">
                        <button id="jpToEnBtn" class="control-btn active" data-direction="jp_to_en">
                            ğŸ‡¯ğŸ‡µâ†’ğŸ‡ºğŸ‡¸
                        </button>
                        <button id="enToJpBtn" class="control-btn" data-direction="en_to_jp">
                            ğŸ‡ºğŸ‡¸â†’ğŸ‡¯ğŸ‡µ
                        </button>
                    </div>
                    <div class="control-grid control-grid-1x1">
                        <button id="mixedBtn" class="control-btn" data-direction="mixed">
                            ğŸ”€ ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="premium-button btn-sakura px-12 py-4 text-lg font-semibold mt-8 sparkle">
                ğŸŒŸ ãƒ¬ãƒƒãƒ„ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
        </div>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="glass-card p-6 w-full max-w-2xl mx-4">
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† -->
                <div class="quiz-header">
                    <div class="quiz-header-top">
                        <div class="quiz-title-section">
                            <h2 class="font-semibold text-xl text-gray-700 text-center">
                                ğŸŒ ONE WORLD Quiz Challenge
                            </h2>
                            <div id="remainingCount" class="text-sm text-gray-600 text-center mt-2"></div>
                        </div>
                        <div class="quiz-timer-section">
                            <div id="timerDisplay" class="timer-display timer-normal">
                                <span id="timerValue">æº–å‚™ä¸­</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å›ºå®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† -->
                <div class="quiz-fixed-content">
                    <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                    <div id="quizQuestion" class="quiz-question"></div>
                    
                    <!-- è§£ç­”è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
                    <div class="text-center">
                        <button id="showAnswerBtn" class="premium-button btn-ocean">
                            ğŸ’¡ è§£ç­”ã‚’è¦‹ã‚‹
                        </button>
                    </div>
                </div>
                
                <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã‚³ãƒ³ãƒ†ãƒ³ãƒ„éƒ¨åˆ† -->
                <div class="quiz-scrollable-content">
                    <div id="answerDisplay" class="answer-display">
                        <div id="answerContent">
                            <div class="text-gray-500" style="text-align: center;">è§£ç­”ã‚’å£°ã«å‡ºã—ã¦ã‹ã‚‰è§£ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</div>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
                    <div class="action-button-container">
                        <button id="quizNext" class="premium-button btn-sakura w-full" disabled>
                            â­ æ¬¡ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="premium-header">
        <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item home" id="footerHomeBtn" title="ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹">
            ğŸ 
        </div>
        
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item back" id="footerBackBtn" title="å‰ã®ç”»é¢ã«æˆ»ã‚‹">
            â—€ï¸
        </div>
        
        <!-- ç·ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTotalStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ†</span>
            <span class="header-stat-number" id="footerTotalClick">0</span>
        </div>
        
        <!-- ä»Šæ—¥ã®ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTodayStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ“…</span>
            <span class="header-stat-number" id="footerTodayClick">0</span>
        </div>
        
        <!-- éŸ³å£°è¨­å®šãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item voice" id="footerVoiceBtn" title="éŸ³å£°è¨­å®š">
            ğŸ¤
        </div>
    </div>

<!-- problems.jsèª­ã¿è¾¼ã¿ -->
<script src="problems.js"></script>

<script>
        /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é …ç›®å®šç¾©ï¼ˆå®Œå…¨ç‰ˆï¼‰ ----------------- */
        const lessons = {
            grade1: [
                {
                    id: 'lesson1',
                    name: 'Lesson1 - æ–‡ã®åŸºæœ¬',
                    grammar: [
                        {id: 'word_order', name: '1. æ—¥æœ¬èªã¨è‹±èªã®èªé †'},
                        {id: 'sentence_types', name: '2. è‹±èªã®æ–‡ã®ä»£è¡¨çš„ãª2ã¤ã®å‹'},
                        {id: 'personal_statements', name: '3. è‡ªåˆ†ã®ã“ã¨ã‚’è¿°ã¹ãŸã‚Šç›¸æ‰‹ã®ã“ã¨ã‚’ãŸãšã­ã‚‹'},
                        {id: 'various_questions', name: '4. ã•ã¾ã–ã¾ãªç–‘å•æ–‡'},
                        {id: 'requests', name: '5. ãŠé¡˜ã„ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ä»£åè©',
                    grammar: [
                        {id: 'she_he_it', name: '1. she, he, it ãªã©ã®ä½¿ã„æ–¹'},
                        {id: 'pronoun_questions', name: '2. she, he ãªã©ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'this_that', name: '3. this ã¨ that ã®ä½¿ã„æ–¹'},
                        {id: 'this_that_questions', name: '4. this, that ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'we_you_they', name: '5. We, you, they ã®ä½¿ã„æ–¹'},
                        {id: 'can_usage', name: '6. can ã®æ„å‘³ã¨ç”¨æ³•'},
                        {id: 'some_any', name: '7. some ã¨ any'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸€èˆ¬å‹•è©',
                    grammar: [
                        {id: 'general_verbs', name: '1. ä¸€èˆ¬å‹•è©ã«ã¯ã€ã©ã‚“ãªã‚‚ã®ãŒã‚ã‚‹ï¼Ÿ'},
                        {id: 'verb_s_es', name: '2. ä¸€èˆ¬å‹•è©ã«ã¤ã s, es'},
                        {id: 'verb_s_es_rules', name: '3. ä¸€èˆ¬å‹•è©ã® s, es ã®ã¤ã‘æ–¹'},
                        {id: 'noun_singular_plural', name: '4. ã€Œ1ã¤ï¼ˆå˜æ•°ï¼‰ã€ãªã®ã‹ã€Œ2ã¤ä»¥ä¸Šï¼ˆè¤‡æ•°ï¼‰ã€ãªã®ã‹ã‚’è¡¨ã™åè©ã«ã¤ã s, es'},
                        {id: 'plural_rules', name: '5. è¤‡æ•°å½¢ã®ã¤ãã‚Šæ–¹'},
                        {id: 'pronoun_i', name: '6. ã€Œç§ã€ã‚’è¡¨ã™2ã¤ã®å½¢'},
                        {id: 'pronoun_cases', name: '7. ä¸»èªã¨ã—ã¦ä½¿ã†å ´åˆã¨ä¸»èªä»¥å¤–ã§ä½¿ã†ã€Œã‚ãªãŸã€ã€Œå½¼ã€ãªã©'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - éå»å½¢',
                    grammar: [
                        {id: 'past_statements', name: '1. éå»ã®ã“ã¨ã‚’è¨€ã†ã¨ã'},
                        {id: 'past_questions', name: '2. éå»ã®ã“ã¨ã‚’ãŸãšã­ã‚‹ã¨ãï¼ˆç–‘å•æ–‡ï¼‰'},
                        {id: 'past_negative', name: '3. éå»ã®ã“ã¨ã§ã€Œã—ãªã‹ã£ãŸã€ã€Œã§ãªã‹ã£ãŸã€ã“ã¨ã‚’è¨€ã†ã¨ãï¼ˆå¦å®šæ–‡ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ç¾åœ¨é€²è¡Œå½¢',
                    grammar: [
                        {id: 'present_continuous', name: '1. ä»Šã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_negative', name: '2. ã€Œã€œã—ã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_questions', name: '3. ã€Œã€œã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã€ã€Œä½•ã‚’ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ç–‘å•è©',
                    grammar: [
                        {id: 'why_because', name: '1. ã€Œç†ç”±ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œç†ç”±ã€ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'how_often', name: '2. ã€Œã©ã®ãã‚‰ã„ã‚ˆãã€œã™ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ç­”ãˆã‚‹ã¨ã'},
                        {id: 'which_who_whose', name: '3. ã€Œã©ã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œã©ã¡ã‚‰ã‚’ã€ã€Œã ã‚ŒãŒã€ã€Œã ã‚Œã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - åŠ©å‹•è©',
                    grammar: [
                        {id: 'must_prohibition', name: '1. ã€Œå¼·ã„å‘½ä»¤ã€ã‚„ã€Œç¦æ­¢ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'have_to_necessity', name: '2. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã€Œã€œã™ã‚‹å¿…è¦ã¯ãªã„ã€ã¨ä¼ãˆã‚‹ã¨ã'},
                        {id: 'may_able_to', name: '3. ã€Œã€œã‹ã‚‚ã—ã‚Œãªã„ã€ã¨è¿°ã¹ã‚‹ã¨ãã€ã€Œã€œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - æœªæ¥è¡¨ç¾',
                    grammar: [
                        {id: 'be_going_to', name: '1. äºˆå®šã‚„è¨ˆç”»ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'will_prediction', name: '2. æœªæ¥ã®ã“ã¨ã«ã¤ã„ã¦ã€Œã€œã ã‚ã†ã€ã¨ã„ã†äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'should', name: '3. ã€Œã€œã™ã¹ãã ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - There is/areæ–‡',
                    grammar: [
                        {id: 'there_is_are', name: '1. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ãŒã‚ã‚‹ï¼ˆã„ã‚‹ï¼‰ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'there_is_are_questions', name: '2. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã‚ã‚Šã¾ã™ã‹ã€ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã„ãã¤ã‚ã‚Šã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹å ´åˆ'},
                        {id: 'look_sound', name: '3. ã€Œã€œãã†ã«è¦‹ãˆã‚‹ï¼èã“ãˆã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade2: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 1å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'have_to_must_review', name: '1. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã‚„ã€Œå¼·ã„å‘½ä»¤ã€ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆhave [has] to ã¨ mustï¼‰'},
                        {id: 'future_review', name: '2. äºˆå®šã‚„æœªæ¥ã«ã¤ã„ã¦ã®äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆbe going to ã¨ willï¼‰'},
                        {id: 'there_is_are_review', name: '3. ã‚‚ã®ãŒã‚ã‚‹ã“ã¨ã‚„ã€äººãŒã„ã‚‹ã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆThere is [are] ~.ï¼‰'},
                        {id: 'there_is_are_transformation', name: '4. There is [are] ~. ã®æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç›®çš„èª2ã¤/æ¥ç¶šè©that',
                    grammar: [
                        {id: 'double_object', name: '1. ã€Œï¼œäººï¼ã«ï¼œã‚‚ã®ï¼ã‚’ã‚ã’ã‚‹ãƒ»é€ã‚‹ã€ãªã©ã¨è¿°ã¹ã‚‹ã¨ãï¼ˆç›®çš„èªã‚’ï¼’ã¤ã¨ã‚‹å‹•è©ï¼‰'},
                        {id: 'that_opinion', name: '2. è‡ªåˆ†ã®æ„è¦‹ã‚„çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'},
                        {id: 'that_feeling', name: '3. è‡ªåˆ†ã®æ°—æŒã¡ã¨ãã®ç†ç”±ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - éå»é€²è¡Œå½¢/æ¥ç¶šè©',
                    grammar: [
                        {id: 'past_continuous', name: '1. éå»ã®ã‚ã‚‹æ™‚ç‚¹ã§ã—ã¦ã„ãŸã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆéå»é€²è¡Œå½¢ï¼‰'},
                        {id: 'when_conjunction', name: '2. ã©ã‚“ãªæ™‚ã®ã“ã¨ã‹ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®whenï¼‰'},
                        {id: 'if_because', name: '3. æ¡ä»¶ã‚’è¿°ã¹ã‚‹ã¨ãã€ç†ç”±ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®ifï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸å®šè©',
                    grammar: [
                        {id: 'infinitive_noun', name: '1. ã—ãŸã„ã“ã¨ã€ãªã‚ŠãŸã„ã‚‚ã®ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆåè©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ã“ã¨ã€ï¼‰'},
                        {id: 'infinitive_adverb', name: '2. ç›®çš„ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå‰¯è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã«ã€ï¼‰'},
                        {id: 'infinitive_adjective', name: '3. ã€Œã‚‚ã®ã®ç”¨é€”ã€ä½•ã‚’ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå½¢å®¹è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã®ã€ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - å‹•åè©',
                    grammar: [
                        {id: 'gerund_object', name: '1. ã€Œã€œã™ã‚‹ã“ã¨ã‚’çµ‚ãˆã‚‹ãƒ»æ¥½ã—ã‚€ãƒ»å¥½ã‚€ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'gerund_subject', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã€ã‚’ä¸»èªã«ã—ã¦è¿°ã¹ã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'teach_tell_that', name: '3. ã€Œã ã‚ŒãŒã ã‚Œã«ã©ã‚“ãªã“ã¨ã‚’æ•™ãˆãŸã‹ãƒ»ä¼ãˆãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä¸å®šè©ã®ç™ºå±•',
                    grammar: [
                        {id: 'how_to_what_to', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã¯ãŠã‚‚ã—ã‚ã„ãƒ»é›£ã—ã„ãƒ»ä¸å¯èƒ½ã ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€œ.ï¼‰'},
                        {id: 'teach_ask_how_to', name: '3. ã€Œã ã‚Œã«ã€œã®ä»•æ–¹ã€ä½•ã‚’ã™ã¹ãã‹ãªã©ã‚’ä¼ãˆã‚‹ãƒ»æ•™ãˆã‚‹ãƒ»ãŸãšã­ã‚‹ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - æ¯”è¼ƒ',
                    grammar: [
                        {id: 'comparative', name: '1. 2ã¤ã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ãã®é•ã„ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¯”è¼ƒç´šï¼‰'},
                        {id: 'superlative', name: '2. 3ã¤ä»¥ä¸Šã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ã€Œã„ã¡ã°ã‚“ã€œã ã€ã¨ä¼ãˆã‚‹ã¨ãï¼ˆæœ€ä¸Šç´šï¼‰'},
                        {id: 'as_as', name: '3. ã€ŒåŒã˜ãã‚‰ã„ã€œã ã€ã€Œã„ã¡ã°ã‚“å¥½ãã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆåŸç´šãªã©ï¼‰'},
                        {id: 'comparison_rules', name: '4. æ¯”è¼ƒç´šãƒ»æœ€ä¸Šç´šã®ä½œã‚Šæ–¹'},
                        {id: 'comparison_transformation', name: '5. æ¯”è¼ƒè¡¨ç¾ã®æ›¸ãæ›ãˆ'},
                        {id: 'comparison_notes', name: '6. ãã®ä»–ã«æ³¨æ„ã™ã‚‹ã“ã¨'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - å—å‹•æ…‹',
                    grammar: [
                        {id: 'passive_voice', name: '1. ã€Œ...ã¯ã€œã•ã‚Œã‚‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã‚‹ã€ã®ã‚ˆã†ãªè¡¨ç¾ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'passive_questions', name: '2. ã€Œâ€¦ã¯ã€œã•ã‚Œã¾ã™ã‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã¾ã™ã‹ã€ãªã©ã¨è³ªå•ã™ã‚‹ã¨ã'},
                        {id: 'passive_modal', name: '3. ã€Œã€œã•ã‚Œã‚‹ã¹ãã ã€ã€Œã€œã•ã‚Œã‚‹ã“ã¨ãŒå¯èƒ½ã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'past_participle_rules', name: '4. éå»åˆ†è©å½¢ã®ä½œã‚Šæ–¹'},
                        {id: 'passive_transformation', name: '5. å—ã‘èº«ã®æ–‡ã®æ›¸ãæ›ãˆä¾‹'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - é–“æ¥ç–‘å•æ–‡/æ„Ÿå˜†æ–‡',
                    grammar: [
                        {id: 'indirect_questions_know', name: '1. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€ŒçŸ¥ã£ã¦ã„ã‚‹ãƒ»çŸ¥ã‚‰ãªã„ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'indirect_questions_tell', name: '2. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€Œã ã‚Œã«è¨€ã£ãŸã‹ãƒ»èã„ãŸã‹ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'exclamatory', name: '3. é©šãã‚„æ„Ÿå‹•ã‚’è¡¨ç¾ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - å‹•è©ã®æ§˜ã€…ãªä½¿ã„æ–¹',
                    grammar: [
                        {id: 'make_call', name: '1. ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ã€Œå‘¼ã³åã¯ä½•ã‹ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'want_ask_to', name: '2. äººã«ã—ã¦ã»ã—ã„ã“ã¨ã‚’ä¼ãˆãŸã‚Šé ¼ã‚“ã ã‚Šã™ã‚‹ã¨ã'},
                        {id: 'let_help', name: '3. è¨±å¯ã‚’å¾—ã‚‹ã¨ãã€ã ã‚ŒãŒæ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã®ã‹ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade3: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 2å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'how_to_what_to_review', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'make_call_review', name: '2. ã€Œå‘¼ã³åã¯ä½•ã‹ã€ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to_review', name: '3. ã€Œã€œã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãƒ»ã‚„ã•ã—ã„ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç¾åœ¨å®Œäº†å½¢(1)',
                    grammar: [
                        {id: 'present_perfect_completion', name: '1. ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience', name: '2. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience_questions', name: '3. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ç¾åœ¨å®Œäº†å½¢(2)',
                    grammar: [
                        {id: 'present_perfect_continuation', name: '1. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuation_questions', name: '2. ã€Œã©ã®ãã‚‰ã„ã€œã—ã¦ã„ã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuous', name: '3. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†é€²è¡Œå½¢ï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - å¾Œç½®ä¿®é£¾',
                    grammar: [
                        {id: 'participle_present', name: '1. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®1ï¼šç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'participle_past', name: '2. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®2ï¼šéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'relative_pronoun_omission', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®3ï¼šç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - é–¢ä¿‚ä»£åè©',
                    grammar: [
                        {id: 'relative_pronoun_who', name: '1. ã€Œã©ã‚“ãªäººã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_which', name: '2. ã€Œã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_object', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä»®å®šæ³•',
                    grammar: [
                        {id: 'subjunctive_1', name: '1. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®1ï¼‰'},
                        {id: 'subjunctive_2', name: '2. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®2ï¼‰'},
                        {id: 'subjunctive_3', name: '3. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®3ï¼‰'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - å¾Œç½®ä¿®é£¾ã¨é–¢ä¿‚ä»£åè©ã®ã¾ã¨ã‚',
                    grammar: [
                        {id: 'postposition_ing', name: '1. ã€ˆåè© ï¼‹ å‹•è©ã®-ingå½¢ ï¼‹ èªå¥ã€‰ï¼ˆç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_past_participle', name: '2. ã€ˆåè© ï¼‹ å‹•è©ã®éå»åˆ†è©å½¢ ï¼‹ èªå¥ã€‰ï¼ˆéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_omission', name: '3. ã€ˆåè© ï¼‹ ä¸»èª ï¼‹ å‹•è© ã€œã€‰ï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'},
                        {id: 'relative_summary', name: '4. ã€ˆåè© ï¼‹ é–¢ä¿‚ä»£åè©ï¼ˆwho, which, thatï¼‰ ï¼‹ èªå¥ã€‰ï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ã¨ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'sentence_transformation', name: '5. æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                }
            ]
        };

        /* ----------------- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆåŠ¹æœéŸ³ã€éŸ³å£°åˆæˆç­‰ï¼‰ ----------------- */
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.initAudio();
            }
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                }
            }
            playClick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(660, 0.08, 0.15);
                } catch (e) {
                    console.log('ã‚¯ãƒªãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playStudyComplete() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(440, 0.25, 0.2);
                } catch (e) {
                    console.log('å®Œäº†éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playSuccess() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(523, 0.15, 0.18);
                } catch (e) {
                    console.log('æˆåŠŸéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(800, 0.05, 0.1);
                } catch (e) {
                    console.log('ãƒãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTimeUp() {
                if (!this.audioContext) return;
                try {
                    this.createWarmTone(220, 0.4, 0.3);
                } catch (e) {
                    console.log('æ™‚é–“åˆ‡ã‚ŒéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            createBell(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createSoftTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'triangle';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createWarmTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
        }

        // éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        class VoiceSystem {
            constructor() {
                this.synth = null;
                this.voices = [];
                this.selectedVoice = null;
                this.isEnabled = true;
                this.deviceType = this.detectDevice();
                this.browserType = this.detectBrowser();
                this.currentMaleVoice = null;
                this.currentFemaleVoice = null;
                
                try {
                    if ('speechSynthesis' in window) {
                        this.synth = window.speechSynthesis;
                        this.initializeVoices();
                    } else {
                        console.log('éŸ³å£°åˆæˆãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const platform = navigator.platform.toLowerCase();
                
                if (/iphone/.test(userAgent)) {
                    return 'iphone';
                } else if (/ipad/.test(userAgent)) {
                    return 'ipad';
                } else if (/ipod/.test(userAgent)) {
                    return 'ipod';
                } else if (platform.includes('mac')) {
                    return 'mac';
                } else if (/android/.test(userAgent)) {
                    if (/mobile/.test(userAgent)) {
                        return 'android_phone';
                    } else {
                        return 'android_tablet';
                    }
                } else if (/windows/.test(userAgent) || platform.includes('win')) {
                    return 'windows';
                } else if (/linux/.test(userAgent) || platform.includes('linux')) {
                    return 'linux';
                } else {
                    return 'other';
                }
            }

            detectBrowser() {
                const userAgent = navigator.userAgent.toLowerCase();
                
                if (/chrome/.test(userAgent) && !/edg/.test(userAgent)) {
                    return 'chrome';
                } else if (/safari/.test(userAgent) && !/chrome/.test(userAgent)) {
                    return 'safari';
                } else if (/firefox/.test(userAgent)) {
                    return 'firefox';
                } else if (/edg/.test(userAgent)) {
                    return 'edge';
                } else {
                    return 'other';
                }
            }

            initializeVoices() {
                this.loadVoices();
                
                if (this.synth.onvoiceschanged !== undefined) {
                    this.synth.onvoiceschanged = () => {
                        this.loadVoices();
                    };
                }

                // éŸ³å£°èª­ã¿è¾¼ã¿å†è©¦è¡Œ
                const retryIntervals = [100, 500, 1000, 2000, 3000, 5000, 8000];
                retryIntervals.forEach((delay) => {
                    setTimeout(() => {
                        this.loadVoices();
                    }, delay);
                });
            }

            loadVoices() {
                if (!this.synth) return;
                
                try {
                    const allVoices = this.synth.getVoices();
                    console.log(`ğŸ¤ åˆ©ç”¨å¯èƒ½éŸ³å£°: ${allVoices.length}å€‹`);
                    
                    this.voices = allVoices.filter(voice => {
                        const lang = voice.lang.toLowerCase();
                        return lang.startsWith('en') || lang.includes('english');
                    });
                    
                    console.log(`ğŸ” è‹±èªéŸ³å£°: ${this.voices.length}å€‹`);
                    
                    // ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°è¨­å®š
                    this.setDeviceRecommendedVoices();
                    
                    this.loadSettings();
                    
                } catch (e) {
                    console.log('éŸ³å£°ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            isMaleVoice(voice) {
                const maleName = voice.name.toLowerCase();
                const maleKeywords = [
                    'male', 'alex', 'daniel', 'aaron', 'fred', 'tom', 'arthur', 'ralph', 'junior',
                    'david', 'mark', 'george', 'guy', 'microsoft david', 'microsoft mark'
                ];
                
                return maleKeywords.some(keyword => maleName.includes(keyword));
            }

            getDeviceVoiceRecommendations() {
                const baseRecommendations = {
                    iphone: {
                        male: ['Daniel', 'Alex', 'Aaron', 'Fred', 'Tom', 'Arthur', 'Ralph'],
                        female: ['Samantha', 'Victoria', 'Karen', 'Susan', 'Allison', 'Ava', 'Kathy', 'Melina']
                    },
                    ipad: {
                        male: ['Alex', 'Daniel', 'Aaron', 'Fred', 'Tom', 'Arthur', 'Ralph'],
                        female: ['Samantha', 'Victoria', 'Karen', 'Susan', 'Allison', 'Ava', 'Kathy']
                    },
                    mac: {
                        male: ['Alex', 'Daniel', 'Aaron', 'Fred', 'Tom', 'Arthur', 'Ralph', 'Junior'],
                        female: ['Samantha', 'Victoria', 'Karen', 'Susan', 'Allison', 'Ava', 'Kathy', 'Melina', 'Fiona']
                    },
                    android_phone: {
                        male: [
                            'Male', 
                            'en-us-x-sfg#male_1-local', 'en-us-x-sfg#male_2-local', 'en-us-x-sfg#male_3-local',
                            'English (United States) Male',
                            'Google US English Male',
                            'Samsung Male',
                            'English (US) Male Voice'
                        ],
                        female: [
                            'Female',
                            'en-us-x-sfg#female_1-local', 'en-us-x-sfg#female_2-local', 'en-us-x-sfg#female_3-local',
                            'English (United States) Female',
                            'Google US English Female',
                            'Samsung Female',
                            'English (US) Female Voice'
                        ]
                    },
                    android_tablet: {
                        male: [
                            'Male',
                            'en-us-x-sfg#male_1-local', 'en-us-x-sfg#male_2-local',
                            'Google US English Male',
                            'English (United States) Male'
                        ],
                        female: [
                            'Female',
                            'en-us-x-sfg#female_1-local', 'en-us-x-sfg#female_2-local',
                            'Google US English Female',
                            'English (United States) Female'
                        ]
                    },
                    windows: {
                        male: ['Microsoft David', 'Microsoft Mark', 'David', 'Mark', 'Microsoft George', 'Microsoft Guy'],
                        female: ['Microsoft Zira', 'Microsoft Hazel', 'Zira', 'Hazel', 'Microsoft Helen', 'Microsoft Eva']
                    },
                    linux: {
                        male: ['Male', 'English (US) Male', 'espeak', 'festival male', 'Google US English Male'],
                        female: ['Female', 'English (US) Female', 'espeak female', 'festival female', 'Google US English Female']
                    },
                    other: {
                        male: ['Male', 'Alex', 'Google US English', 'English Male', 'Default Male', 'Daniel'],
                        female: ['Female', 'Samantha', 'Google US English', 'English Female', 'Default Female', 'Victoria']
                    }
                };

                const browserAdjustments = {
                    chrome: {
                        malePrefix: ['Google US English Male', 'Chrome OS US English Male'],
                        femalePrefix: ['Google US English Female', 'Chrome OS US English Female']
                    },
                    safari: {
                        malePrefix: ['Alex', 'Daniel', 'Aaron'],
                        femalePrefix: ['Samantha', 'Victoria', 'Susan']
                    },
                    firefox: {
                        malePrefix: ['Male', 'English (US) Male'],
                        femalePrefix: ['Female', 'English (US) Female']
                    },
                    edge: {
                        malePrefix: ['Microsoft David', 'Microsoft Mark'],
                        femalePrefix: ['Microsoft Zira', 'Microsoft Hazel']
                    }
                };

                let recommendations = baseRecommendations[this.deviceType] || baseRecommendations.other;

                if (browserAdjustments[this.browserType]) {
                    const browserAdj = browserAdjustments[this.browserType];
                    recommendations = {
                        male: [...browserAdj.malePrefix, ...recommendations.male],
                        female: [...browserAdj.femalePrefix, ...recommendations.female]
                    };
                }

                return recommendations;
            }

            setDeviceRecommendedVoices() {
                const recommendations = this.getDeviceVoiceRecommendations();
                
                this.currentMaleVoice = this.findBestVoice(recommendations.male);
                this.currentFemaleVoice = this.findBestVoice(recommendations.female);
                
                console.log('ğŸ¯ æ¨å¥¨éŸ³å£°è¨­å®š:', {
                    device: this.deviceType,
                    browser: this.browserType,
                    male: this.currentMaleVoice?.name,
                    female: this.currentFemaleVoice?.name
                });
                
                if (!this.selectedVoice) {
                    this.selectedVoice = this.currentFemaleVoice || this.currentMaleVoice || this.voices[0];
                }
            }

            findBestVoice(candidateNames) {
                for (const name of candidateNames) {
                    const voice = this.voices.find(v => 
                        v.name.toLowerCase().includes(name.toLowerCase()) ||
                        name.toLowerCase().includes(v.name.toLowerCase())
                    );
                    if (voice) {
                        return voice;
                    }
                }
                return null;
            }

            selectGenderVoice(gender) {
                let targetVoice = null;
                
                if (gender === 'male') {
                    targetVoice = this.currentMaleVoice;
                } else if (gender === 'female') {
                    targetVoice = this.currentFemaleVoice;
                }
                
                if (targetVoice) {
                    this.selectedVoice = targetVoice;
                    this.saveSettings();
                    this.updateVoiceSelectionUI(gender);
                    console.log(`ğŸ¤ éŸ³å£°é¸æŠ: ${gender} - ${targetVoice.name}`);
                    return true;
                }
                return false;
            }

            updateVoiceSelectionUI(selectedGender) {
                document.querySelectorAll('.voice-gender-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const targetBtn = document.querySelector(`[data-voice-gender="${selectedGender}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('selected');
                }
            }

            testVoice(gender) {
                const deviceMessages = {
                    iphone: {
                        male: "Hello! I'm optimized for your iPhone. Let's practice English together!",
                        female: "Hi there! I'm your iPhone English learning companion. Ready to improve?"
                    },
                    ipad: {
                        male: "Greetings! I'm designed for your iPad's excellent speakers. Let's learn!",
                        female: "Hello! Your iPad and I make a perfect learning team. Let's get started!"
                    },
                    android_phone: {
                        male: "Hi! I'm the best voice for your Android phone. Ready for English practice?",
                        female: "Hello! I'm optimized for Android devices. Let's master English together!"
                    },
                    android_tablet: {
                        male: "Hello! I work great on your Android tablet. Let's start learning!",
                        female: "Hi there! Your Android tablet and I are ready for English lessons!"
                    },
                    windows: {
                        male: "Hello! I'm the Windows voice assistant for your English learning journey.",
                        female: "Hi! I'm here to help you learn English on your Windows computer."
                    },
                    mac: {
                        male: "Hello! I'm the Mac voice optimized for clear English pronunciation.",
                        female: "Hi there! I'm your Mac's English learning voice assistant."
                    },
                    linux: {
                        male: "Hello! I'm working on your Linux system to help you learn English.",
                        female: "Hi! I'm the Linux voice ready to assist your English studies."
                    },
                    other: {
                        male: "Hello! I'm here to help you practice English pronunciation clearly.",
                        female: "Hi there! I'm ready to be your English learning voice companion."
                    }
                };
                
                const messages = deviceMessages[this.deviceType] || deviceMessages.other;
                const testText = messages[gender];
                
                if (gender === 'male' && this.currentMaleVoice) {
                    this.testSpecificVoice(this.currentMaleVoice, testText);
                } else if (gender === 'female' && this.currentFemaleVoice) {
                    this.testSpecificVoice(this.currentFemaleVoice, testText);
                }
            }

            testSpecificVoice(voice, text) {
                try {
                    this.synth.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = voice;
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.8;
                    
                    console.log(`ğŸ”Š éŸ³å£°ãƒ†ã‚¹ãƒˆ: ${voice.name}`);
                    this.synth.speak(utterance);
                } catch (e) {
                    console.log('éŸ³å£°ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            speak(text) {
                if (!this.isEnabled || !text.trim() || !this.synth) return;
                
                try {
                    this.synth.cancel();
                    
                    const cleanText = this.cleanEnglishText(text);
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    
                    if (this.selectedVoice) {
                        utterance.voice = this.selectedVoice;
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.85;
                    
                    this.synth.speak(utterance);
                    return utterance;
                    
                } catch (e) {
                    console.log('éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            cleanEnglishText(text) {
                return text
                    .replace(/[^\w\s.!?',\-]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            setEnabled(enabled) {
                this.isEnabled = enabled;
                this.saveSettings();
                
                if (!enabled && this.synth) {
                    try {
                        this.synth.cancel();
                    } catch (e) {
                        console.log('éŸ³å£°åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    }
                }
            }

            saveSettings() {
                try {
                    const settings = {
                        voiceName: this.selectedVoice ? this.selectedVoice.name : null,
                        isEnabled: this.isEnabled,
                        deviceType: this.deviceType,
                        browserType: this.browserType
                    };
                    localStorage.setItem('oneWorldQuizVoiceSettings', JSON.stringify(settings));
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('oneWorldQuizVoiceSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.isEnabled = settings.isEnabled !== false;
                        
                        if (settings.voiceName && this.voices.length > 0) {
                            const savedVoice = this.voices.find(v => v.name === settings.voiceName);
                            if (savedVoice) {
                                this.selectedVoice = savedVoice;
                                const gender = (savedVoice === this.currentMaleVoice) ? 'male' : 'female';
                                this.updateVoiceSelectionUI(gender);
                            }
                        }
                    }
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            getSelectedVoiceName() {
                return this.selectedVoice ? this.selectedVoice.name : 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
            }

            getDeviceInfo() {
                const deviceNames = {
                    iphone: 'iPhone',
                    ipad: 'iPad',
                    ipod: 'iPod',
                    mac: 'Mac',
                    android_phone: 'Androidã‚¹ãƒãƒ›',
                    android_tablet: 'Androidã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ',
                    windows: 'Windows PC',
                    linux: 'Linux PC',
                    other: 'ãã®ä»–ãƒ‡ãƒã‚¤ã‚¹'
                };

                const browserNames = {
                    chrome: 'Google Chrome',
                    safari: 'Safari',
                    firefox: 'Firefox',
                    edge: 'Microsoft Edge',
                    other: 'ãã®ä»–ãƒ–ãƒ©ã‚¦ã‚¶'
                };
                
                return {
                    type: this.deviceType,
                    typeName: deviceNames[this.deviceType] || 'ãã®ä»–',
                    browser: this.browserType,
                    browserName: browserNames[this.browserType] || 'ãã®ä»–',
                    totalVoices: this.voices.length,
                    maleVoice: this.currentMaleVoice?.name || 'ãªã—',
                    femaleVoice: this.currentFemaleVoice?.name || 'ãªã—',
                    selectedVoice: this.selectedVoice?.name || 'ãªã—'
                };
            }
        }

        let soundSystem, voiceSystem;
        try {
            soundSystem = new SoundSystem();
            voiceSystem = new VoiceSystem();
        } catch (e) {
            console.log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
            soundSystem = { playClick: () => {}, playStudyComplete: () => {}, playSuccess: () => {}, playTick: () => {}, playTimeUp: () => {} };
            voiceSystem = { speak: () => {}, selectGenderVoice: () => false, testVoice: () => {}, setEnabled: () => {}, isEnabled: true };
        }

        /* ----------------- ã‚²ãƒ¼ãƒ å¤‰æ•° ----------------- */
        let selectedGrammarItems = [];
        let selectedLessons = [];
        let currentQuestionIndex = 0;
        let studyCount = 0;
        let sessionClickCount = 0;
        let usedQuestions = [];
        let particleOffset = 0;
        let currentGrade = '';
        let currentLesson = '';
        let questionMode = 'random';
        let sequentialIndex = 0;
        let questionDirection = 'jp_to_en';
        let timerLimit = 3;
        let timerInterval = null;
        let currentTimerValue = 0;
        let isTimerRunning = false;
        let isQuizAnswered = false;
        let allQuestions = [];
        let currentScreen = 'main';

        /* ----------------- ã‚¯ãƒªãƒƒã‚¯æ•°ç®¡ç†æ©Ÿèƒ½ ----------------- */
        let clickStats = { total: 0, daily: {} };

        function getTodayDateString() {
            const today = new Date();
            return today.getFullYear() + '-' + 
                   String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(today.getDate()).padStart(2, '0');
        }

        function incrementClickCount() {
            const today = getTodayDateString();
            
            clickStats.total++;
            sessionClickCount++;
            
            if (!clickStats.daily[today]) {
                clickStats.daily[today] = 0;
            }
            clickStats.daily[today]++;
            
            updateClickDisplays();
            saveClickStats();
            
            if (clickStats.total % 10 === 0) {
                createParticle('âœ¨', '#a584c7', window.innerWidth / 2, window.innerHeight / 2);
            }
            
            if (clickStats.total % 100 === 0) {
                soundSystem.playSuccess();
                createParticle('ğŸ†', '#f4a261', window.innerWidth / 2, window.innerHeight / 2);
            }
            
            return true;
        }

        function updateClickDisplays() {
            try {
                const today = getTodayDateString();
                const todayClicks = clickStats.daily[today] || 0;
                
                const headerTotalElement = document.getElementById('footerTotalClick');
                const headerTodayElement = document.getElementById('footerTodayClick');
                const sessionElement = document.getElementById('clickCount');
                
                if (headerTotalElement) {
                    headerTotalElement.textContent = clickStats.total;
                }
                if (headerTodayElement) {
                    headerTodayElement.textContent = todayClicks;
                }
                if (sessionElement) {
                    sessionElement.textContent = sessionClickCount;
                }
                
            } catch (e) {
                console.log('ã‚¯ãƒªãƒƒã‚¯è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function saveClickStats() {
            try {
                localStorage.setItem('oneWorldQuizClickStats', JSON.stringify(clickStats));
            } catch (e) {
                console.log('ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function loadClickStats() {
            try {
                const saved = localStorage.getItem('oneWorldQuizClickStats');
                if (saved) {
                    clickStats = JSON.parse(saved);
                    updateClickDisplays();
                }
            } catch (e) {
                console.log('ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                clickStats = { total: 0, daily: {} };
            }
        }

        function confirmResetTotal() {
            if (confirm('ğŸ† ç·ã‚¯ãƒªãƒƒã‚¯æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰')) {
                clickStats.total = 0;
                saveClickStats();
                updateClickDisplays();
                soundSystem.playClick();
            }
        }

        function confirmResetToday() {
            if (confirm('ğŸ“… ä»Šæ—¥ã®ã‚¯ãƒªãƒƒã‚¯æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰')) {
                const today = getTodayDateString();
                clickStats.daily[today] = 0;
                saveClickStats();
                updateClickDisplays();
                soundSystem.playClick();
            }
        }

        /* ----------------- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé–¢æ•° ----------------- */
        function createParticle(text, color, x, y) {
            try {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = text;
                particle.style.color = color;
                particle.style.left = (x + particleOffset) + 'px';
                particle.style.top = (y + particleOffset) + 'px';
                particle.style.fontSize = '24px';
                document.body.appendChild(particle);

                particleOffset += 50;
                if (particleOffset > 200) particleOffset = 0;

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 3000);
            } catch (e) {
                console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- ç”»é¢é·ç§»é–¢æ•° ----------------- */
        function updateBackButton() {
            const backBtn = document.getElementById('footerBackBtn');
            const homeBtn = document.getElementById('footerHomeBtn');
            
            if (currentScreen === 'main') {
                backBtn.style.opacity = '0.5';
                backBtn.style.pointerEvents = 'none';
                homeBtn.style.opacity = '0.5';
                homeBtn.style.pointerEvents = 'none';
            } else {
                backBtn.style.opacity = '1';
                backBtn.style.pointerEvents = 'auto';
                homeBtn.style.opacity = '1';
                homeBtn.style.pointerEvents = 'auto';
            }
        }

        function hideAllModals() {
            try {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('show');
                });
            } catch (e) {
                console.log('ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function goBackToMain() {
            try {
                hideAllModals();
                const gameScreen = document.getElementById('gameScreen');
                if (gameScreen) {
                    gameScreen.classList.add('hidden');
                }
                const mainModal = document.getElementById('mainGradeModal');
                if (mainModal) {
                    mainModal.classList.add('show');
                }
                currentScreen = 'main';
                updateBackButton();
                soundSystem.playClick();
                currentGrade = '';
                
                resetLessonSelections();
                selectedLessons = [];
                selectedGrammarItems = [];
                
            } catch (e) {
                console.log('ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function resetLessonSelections() {
            try {
                ['grade1', 'grade2', 'grade3'].forEach(grade => {
                    const container = document.getElementById(`${grade}Lessons`);
                    if (container) {
                        container.querySelectorAll('.lesson-btn').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                    }

                    const gradeNum = grade.replace('grade', '');
                    const startButton = document.getElementById(`startMultipleLessons${gradeNum}`);
                    if (startButton) {
                        startButton.style.display = 'none';
                        startButton.disabled = true;
                    }
                });
            } catch (e) {
                console.log('ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        }

        function goBackToGrade(grade) {
            try {
                hideAllModals();
                const gradeModal = document.getElementById(`${grade}Modal`);
                if (gradeModal) {
                    gradeModal.classList.add('show');
                }
                currentScreen = 'grade';
                updateBackButton();
                soundSystem.playClick();
                selectedGrammarItems = [];
            } catch (e) {
                console.log('å­¦å¹´ç”»é¢ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function goBackToGameSettings() {
            try {
                hideAllModals();
                const gameScreen = document.getElementById('gameScreen');
                if (gameScreen) {
                    gameScreen.classList.remove('hidden');
                }
                currentScreen = 'game';
                updateBackButton();
                soundSystem.playClick();
                
                resetQuizState();
                
            } catch (e) {
                console.log('ã‚²ãƒ¼ãƒ è¨­å®šç”»é¢ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function resetQuizState() {
            try {
                usedQuestions = [];
                currentQuestionIndex = 0;
                sequentialIndex = 0;
                isQuizAnswered = false;
                
                stopTimer();
            } catch (e) {
                console.log('ã‚¯ã‚¤ã‚ºçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        }

        function goBack() {
            try {
                incrementClickCount();
                soundSystem.playClick();
                
                if (currentScreen === 'quiz') {
                    goBackToGameSettings();
                } else if (currentScreen === 'game') {
                    goBackToGrade(currentGrade);
                } else if (currentScreen === 'grammar') {
                    goBackToGrade(currentGrade);
                } else if (currentScreen === 'grade') {
                    goBackToMain();
                } else if (currentScreen === 'voice') {
                    closeVoiceSettings();
                } else {
                    goBackToMain();
                }
            } catch (e) {
                console.log('æˆ»ã‚‹å‹•ä½œã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- éŸ³å£°æ©Ÿèƒ½é–¢æ•° ----------------- */
        function generateSimpleVoiceSelection() {
            const container = document.getElementById('simpleVoiceSelection');
            if (!container) return;
            
            const deviceInfo = voiceSystem.getDeviceInfo();
            
            const simpleHTML = `
                <div class="simple-voice-container">
                    <div class="voice-selection-title">
                        ğŸ¤ éŸ³å£°é¸æŠ
                    </div>
                    
                    <div class="voice-gender-btn" data-voice-gender="male" onclick="selectAndTestVoice('male')">
                        <div class="voice-gender-icon">ğŸ‘¨</div>
                        <div class="voice-gender-label">ç”·æ€§éŸ³å£°</div>
                        <div class="voice-gender-description">
                            ${deviceInfo.typeName}ã«æœ€é©åŒ–ã•ã‚ŒãŸç”·æ€§ã®éŸ³å£°
                        </div>
                    </div>

                    <div class="voice-gender-btn" data-voice-gender="female" onclick="selectAndTestVoice('female')">
                        <div class="voice-gender-icon">ğŸ‘©</div>
                        <div class="voice-gender-label">å¥³æ€§éŸ³å£°</div>
                        <div class="voice-gender-description">
                            ${deviceInfo.typeName}ã«æœ€é©åŒ–ã•ã‚ŒãŸå¥³æ€§ã®éŸ³å£°
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <div class="text-sm text-gray-600">
                            ğŸ’¡ ç¾åœ¨é¸æŠä¸­: ${deviceInfo.selectedVoice}
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = simpleHTML;
            
            if (voiceSystem.selectedVoice) {
                const currentGender = (voiceSystem.selectedVoice === voiceSystem.currentMaleVoice) ? 'male' : 'female';
                voiceSystem.updateVoiceSelectionUI(currentGender);
            }
        }

        function selectAndTestVoice(gender) {
            incrementClickCount();
            soundSystem.playClick();
            
            if (voiceSystem.selectGenderVoice(gender)) {
                console.log(`âœ… ${gender}éŸ³å£°ã‚’é¸æŠã—ã¾ã—ãŸ`);
                setTimeout(() => {
                    voiceSystem.testVoice(gender);
                }, 300);
            }
        }

        function openVoiceSettings() {
            try {
                const modal = document.getElementById('voiceSettingsModal');
                const enabledCheckbox = document.getElementById('voiceEnabled');
                const toggleDescription = document.getElementById('voiceToggleDescription');
                
                if (enabledCheckbox && toggleDescription) {
                    enabledCheckbox.checked = voiceSystem.isEnabled;
                    toggleDescription.textContent = voiceSystem.isEnabled ? 'éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™' : 'éŸ³å£°æ©Ÿèƒ½ãŒç„¡åŠ¹ã§ã™';
                }
                
                generateSimpleVoiceSelection();
                
                currentScreen = 'voice';
                updateBackButton();
                
                if (modal) {
                    modal.classList.add('show');
                }
                
                console.log('éŸ³å£°è¨­å®šç”»é¢è¡¨ç¤º');
                
            } catch (e) {
                console.log('éŸ³å£°è¨­å®šç”»é¢ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        }

        function closeVoiceSettings() {
            try {
                const modal = document.getElementById('voiceSettingsModal');
                if (modal) {
                    modal.classList.remove('show');
                }
                
                if (currentScreen === 'voice') {
                    currentScreen = 'main';
                    hideAllModals();
                    const mainModal = document.getElementById('mainGradeModal');
                    if (mainModal) {
                        mainModal.classList.add('show');
                    }
                }
                
                updateBackButton();
            } catch (e) {
                console.log('éŸ³å£°è¨­å®šç”»é¢ã®é–‰ã˜ã‚‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function toggleVoiceEnabled() {
            try {
                const checkbox = document.getElementById('voiceEnabled');
                const description = document.getElementById('voiceToggleDescription');
                
                if (checkbox && description) {
                    voiceSystem.setEnabled(checkbox.checked);
                    description.textContent = checkbox.checked ? 'éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™' : 'éŸ³å£°æ©Ÿèƒ½ãŒç„¡åŠ¹ã§ã™';
                }
            } catch (e) {
                console.log('éŸ³å£°åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function addSpeakButton(text, container) {
            try {
                const englishRegex = /[a-zA-Z]/;
                if (!englishRegex.test(text)) return container;
                
                const speakBtn = document.createElement('button');
                speakBtn.className = 'speak-btn';
                speakBtn.innerHTML = 'ğŸ”Š';
                speakBtn.title = 'è‹±èªã§èª­ã¿ä¸Šã’';
                speakBtn.onclick = (e) => {
                    e.stopPropagation();
                    speakEnglishText(text, speakBtn);
                };
                
                const wrapper = document.createElement('span');
                wrapper.style.display = 'inline-flex';
                wrapper.style.alignItems = 'center';
                wrapper.appendChild(document.createTextNode(text));
                wrapper.appendChild(speakBtn);
                
                return wrapper;
            } catch (e) {
                console.log('ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒœã‚¿ãƒ³ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
                return container;
            }
        }

        function speakEnglishText(text, button = null) {
            try {
                if (!voiceSystem.isEnabled) {
                    return;
                }
                
                if (button) {
                    button.classList.add('speaking');
                }
                
                const utterance = voiceSystem.speak(text);
                
                if (utterance) {
                    utterance.onend = () => {
                        if (button) {
                            button.classList.remove('speaking');
                        }
                    };
                }
            } catch (e) {
                console.log('éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                if (button) {
                    button.classList.remove('speaking');
                }
            }
        }

        /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠæ©Ÿèƒ½ ----------------- */
        function toggleLessonSelection(grade, lessonId, lessonName) {
            try {
                const lessonBtn = document.querySelector(`#${grade}Lessons [data-lesson-id="${lessonId}"]`);
                
                if (!lessonBtn) {
                    console.error('ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', lessonId);
                    return;
                }

                const isSelected = lessonBtn.classList.contains('selected');
                
                if (isSelected) {
                    lessonBtn.classList.remove('selected');
                    selectedLessons = selectedLessons.filter(lesson => lesson.id !== lessonId);
                } else {
                    lessonBtn.classList.add('selected');
                    selectedLessons.push({id: lessonId, name: lessonName, grade: grade});
                }
                
                updateSelectedLessonsDisplay(grade);
                
            } catch (e) {
                console.error('ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠåˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
            }
        }

        function updateSelectedLessonsDisplay(grade) {
            try {
                const gradeNum = grade.replace('grade', '');
                const startButton = document.getElementById(`startMultipleLessons${gradeNum}`);
                
                const gradeSelectedLessons = selectedLessons.filter(lesson => lesson.grade === grade);
                
                if (gradeSelectedLessons.length > 0) {
                    startButton.style.display = 'inline-block';
                    startButton.disabled = false;
                } else {
                    startButton.style.display = 'none';
                    startButton.disabled = true;
                }
                
            } catch (e) {
                console.log('é¸æŠãƒ¬ãƒƒã‚¹ãƒ³è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function startSelectedLessons(grade) {
            try {
                if (selectedLessons.length === 0) {
                    return;
                }
                
                currentGrade = grade;
                showGrammarSelection();
                
            } catch (e) {
                console.log('ãƒ¬ãƒƒã‚¹ãƒ³é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function showGrammarSelection() {
            try {
                hideAllModals();
                
                const modal = document.getElementById('grammarModal');
                const title = document.getElementById('grammarModalTitle');
                const container = document.getElementById('grammarCategories');
                
                title.textContent = `ğŸ“š ${selectedLessons.map(l => l.name).join(', ')} - æ–‡æ³•é …ç›®é¸æŠ`;
                
                container.innerHTML = '';
                selectedGrammarItems = [];
                
                selectedLessons.forEach(lesson => {
                    const lessonData = lessons[lesson.grade].find(l => l.id === lesson.id);
                    if (lessonData) {
                        lessonData.grammar.forEach(grammar => {
                            const btn = document.createElement('button');
                            btn.className = 'grammar-btn';
                            btn.textContent = grammar.name;
                            btn.dataset.grammarId = `${lesson.id}_${grammar.id}`;
                            btn.dataset.lessonId = lesson.id;
                            btn.dataset.grade = lesson.grade;
                            
                            btn.addEventListener('click', () => {
                                incrementClickCount();
                                soundSystem.playClick();
                                toggleGrammarSelection(btn, grammar, lesson);
                            });
                            
                            container.appendChild(btn);
                        });
                    }
                });
                
                currentScreen = 'grammar';
                updateBackButton();
                modal.classList.add('show');
                
            } catch (e) {
                console.log('æ–‡æ³•é¸æŠç”»é¢è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function toggleGrammarSelection(btn, grammar, lesson) {
            try {
                const isSelected = btn.classList.contains('selected');
                const grammarKey = `${lesson.id}_${grammar.id}`;
                
                if (isSelected) {
                    btn.classList.remove('selected');
                    selectedGrammarItems = selectedGrammarItems.filter(item => item.key !== grammarKey);
                } else {
                    btn.classList.add('selected');
                    selectedGrammarItems.push({
                        key: grammarKey,
                        lessonId: lesson.id,
                        grammarId: grammar.id,
                        name: grammar.name,
                        grade: lesson.grade
                    });
                }
                
                const startButton = document.getElementById('startGrammarQuiz');
                if (selectedGrammarItems.length > 0) {
                    startButton.disabled = false;
                } else {
                    startButton.disabled = true;
                }
                
            } catch (e) {
                console.log('æ–‡æ³•é¸æŠåˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function startGrammarQuiz() {
            try {
                if (selectedGrammarItems.length === 0) {
                    return;
                }
                
                prepareQuestions();
                showGameScreen();
                
            } catch (e) {
                console.log('æ–‡æ³•ã‚¯ã‚¤ã‚ºé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- problems.jsé€£æºã«ã‚ˆã‚‹å•é¡Œæº–å‚™ ----------------- */
        function prepareQuestions() {
            try {
                allQuestions = [];
                
                if (typeof problemDatabase === 'undefined') {
                    console.error('âŒ problems.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                    alert('å•é¡Œãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆproblems.jsï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\nãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                console.log('ğŸ“š problems.jsé€£æºé–‹å§‹');
                console.log('åˆ©ç”¨å¯èƒ½ãªå•é¡Œãƒ‡ãƒ¼ã‚¿ã‚­ãƒ¼:', Object.keys(problemDatabase));
                
                selectedGrammarItems.forEach(item => {
                    const problemKey = `${item.grade}_${item.lessonId}_${item.grammarId}`;
                    console.log(`ğŸ” å•é¡Œæ¤œç´¢: ${problemKey}`);
                    
                    const problems = problemDatabase[problemKey];
                    if (problems && Array.isArray(problems)) {
                        console.log(`âœ… å•é¡Œç™ºè¦‹: ${problemKey} - ${problems.length}å•`);
                        problems.forEach(problem => {
                            allQuestions.push({
                                jp: problem.q,
                                en: problem.ans,
                                explanation: problem.exp || 'è§£èª¬ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
                                grammarName: item.name,
                                lessonId: item.lessonId,
                                grade: item.grade,
                                problemKey: problemKey
                            });
                        });
                    } else {
                        console.warn(`âš ï¸ å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${problemKey}`);
                    }
                });
                
                if (allQuestions.length === 0) {
                    console.warn('âš ï¸ é¸æŠã•ã‚ŒãŸå†…å®¹ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    
                    allQuestions = [
                        {
                            jp: "ç§ã¯è‹±èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚",
                            en: "I am studying English.",
                            explanation: "ç¾åœ¨é€²è¡Œå½¢ã¯ã€Œbeå‹•è© + å‹•è©ã®ingå½¢ã€ã§è¡¨ã—ã¾ã™ã€‚ä»Šã¾ã•ã«è¡Œã£ã¦ã„ã‚‹å‹•ä½œã‚’è¡¨ç¾ã§ãã¾ã™ã€‚",
                            grammarName: "ç¾åœ¨é€²è¡Œå½¢",
                            lessonId: "sample",
                            grade: currentGrade
                        },
                        {
                            jp: "å½¼ã¯æ˜¨æ—¥æ˜ ç”»ã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "He watched a movie yesterday.",
                            explanation: "éå»å½¢ã¯å‹•è©ã®éå»å½¢ã‚’ä½¿ã£ã¦è¡¨ã—ã¾ã™ã€‚è¦å‰‡å‹•è©ã¯èªå°¾ã«(e)dã‚’ä»˜ã‘ã¾ã™ã€‚",
                            grammarName: "éå»å½¢",
                            lessonId: "sample",
                            grade: currentGrade
                        },
                        {
                            jp: "ç§ã¯æ˜æ—¥å‹é”ã«ä¼šã†äºˆå®šã§ã™ã€‚",
                            en: "I am going to meet my friend tomorrow.",
                            explanation: "ã€Œbe going to + å‹•è©ã®åŸå½¢ã€ã§äºˆå®šã‚„è¨ˆç”»ã‚’è¡¨ã—ã¾ã™ã€‚ç¢ºå®Ÿæ€§ã®é«˜ã„æœªæ¥ã‚’è¡¨ç¾ã—ã¾ã™ã€‚",
                            grammarName: "æœªæ¥è¡¨ç¾",
                            lessonId: "sample",
                            grade: currentGrade
                        }
                    ];
                    
                    alert('ğŸ“ é¸æŠã•ã‚ŒãŸå†…å®¹ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒã¾ã æº–å‚™ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nã‚µãƒ³ãƒ—ãƒ«å•é¡Œã§å­¦ç¿’ã‚’ç¶šã‘ã¾ã™ã€‚');
                }
                
                usedQuestions = [];
                currentQuestionIndex = 0;
                sequentialIndex = 0;
                
                console.log(`âœ… å•é¡Œæº–å‚™å®Œäº†: ${allQuestions.length}å•`);
                console.log('é¸æŠã•ã‚ŒãŸæ–‡æ³•é …ç›®:', selectedGrammarItems.map(item => item.name).join(', '));
                
            } catch (e) {
                console.error('âŒ å•é¡Œæº–å‚™ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                alert('å•é¡Œã®æº–å‚™ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\nãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }

        function showGameScreen() {
            try {
                hideAllModals();
                const gameScreen = document.getElementById('gameScreen');
                gameScreen.classList.remove('hidden');
                
                const categoryElement = document.getElementById('currentCategory');
                categoryElement.textContent = selectedGrammarItems.map(item => item.name).join(', ');
                
                updateClickDisplays();
                
                currentScreen = 'game';
                updateBackButton();
                
            } catch (e) {
                console.log('ã‚²ãƒ¼ãƒ ç”»é¢è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ ----------------- */
        function startTimer() {
            try {
                if (timerLimit === 'unlimited') {
                    updateTimerDisplayUnlimited();
                    return;
                }
                
                currentTimerValue = timerLimit;
                isTimerRunning = true;
                updateTimerDisplay();
                
                timerInterval = setInterval(() => {
                    currentTimerValue--;
                    updateTimerDisplay();
                    
                    if (currentTimerValue <= 0) {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        handleTimerExpired();
                    } else if (currentTimerValue <= 2) {
                        soundSystem.playTick();
                    }
                }, 1000);
                
            } catch (e) {
                console.log('ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function updateTimerDisplay() {
            try {
                const timerValue = document.getElementById('timerValue');
                const timerDisplay = document.getElementById('timerDisplay');
                
                if (timerValue && timerDisplay) {
                    timerValue.textContent = currentTimerValue;
                    
                    if (currentTimerValue > 3) {
                        timerDisplay.className = 'timer-display timer-normal';
                    } else if (currentTimerValue > 1) {
                        timerDisplay.className = 'timer-display timer-warning';
                    } else {
                        timerDisplay.className = 'timer-display timer-danger';
                    }
                }
            } catch (e) {
                console.log('ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function updateTimerDisplayUnlimited() {
            try {
                const timerValue = document.getElementById('timerValue');
                const timerDisplay = document.getElementById('timerDisplay');
                
                if (timerValue && timerDisplay) {
                    timerValue.textContent = 'âˆ';
                    timerDisplay.className = 'timer-display timer-unlimited';
                }
            } catch (e) {
                console.log('ç„¡åˆ¶é™ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function handleTimerExpired() {
            try {
                soundSystem.playTimeUp();
                
                if (!isQuizAnswered) {
                    showAnswer();
                }
                
            } catch (e) {
                console.log('ã‚¿ã‚¤ãƒãƒ¼æœŸé™åˆ‡ã‚Œå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function stopTimer() {
            try {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                isTimerRunning = false;
            } catch (e) {
                console.log('ã‚¿ã‚¤ãƒãƒ¼åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ ----------------- */
        function startQuiz() {
            try {
                if (allQuestions.length === 0) {
                    return;
                }
                
                hideAllModals();
                const gameScreenElement = document.getElementById('gameScreen');
                gameScreenElement.classList.add('hidden');
                
                const modal = document.getElementById('quizModal');
                modal.classList.add('show');
                
                currentScreen = 'quiz';
                updateBackButton();
                
                resetQuizState();
                
                showNextQuestion();
                
            } catch (e) {
                console.log('ã‚¯ã‚¤ã‚ºé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function showNextQuestion() {
            try {
                if (usedQuestions.length >= allQuestions.length) {
                    endQuiz();
                    return;
                }
                
                let nextQuestion;
                
                if (questionMode === 'random') {
                    const availableQuestions = allQuestions.filter((_, index) => !usedQuestions.includes(index));
                    const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                    nextQuestion = availableQuestions[randomIndex];
                    currentQuestionIndex = allQuestions.indexOf(nextQuestion);
                } else {
                    if (sequentialIndex >= allQuestions.length) {
                        sequentialIndex = 0;
                    }
                    nextQuestion = allQuestions[sequentialIndex];
                    currentQuestionIndex = sequentialIndex;
                }
                
                displayQuestion(nextQuestion);
                isQuizAnswered = false;
                
                const remainingElement = document.getElementById('remainingCount');
                if (remainingElement) {
                    remainingElement.textContent = `æ®‹ã‚Š: ${allQuestions.length - usedQuestions.length}å•`;
                }
                
                startTimer();
                
            } catch (e) {
                console.log('æ¬¡ã®å•é¡Œè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function displayQuestion(question) {
            try {
                const questionElement = document.getElementById('quizQuestion');
                const answerDisplay = document.getElementById('answerDisplay');
                const answerContent = document.getElementById('answerContent');
                const showAnswerBtn = document.getElementById('showAnswerBtn');
                const nextBtn = document.getElementById('quizNext');
                
                let questionText = '';
                let currentQuestionType = '';
                
                if (questionDirection === 'jp_to_en') {
                    questionText = question.jp;
                    currentQuestionType = 'jp_to_en';
                } else if (questionDirection === 'en_to_jp') {
                    questionText = question.en;
                    currentQuestionType = 'en_to_jp';
                } else {
                    const isJpToEn = Math.random() < 0.5;
                    questionText = isJpToEn ? question.jp : question.en;
                    currentQuestionType = isJpToEn ? 'jp_to_en' : 'en_to_jp';
                }
                
                questionElement.dataset.questionType = currentQuestionType;
                questionElement.textContent = questionText;
                
                answerDisplay.classList.remove('show');
                answerContent.innerHTML = '<div class="text-gray-500" style="text-align: center;">è§£ç­”ã‚’å£°ã«å‡ºã—ã¦ã‹ã‚‰è§£ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</div>';
                
                showAnswerBtn.disabled = false;
                showAnswerBtn.textContent = 'ğŸ’¡ è§£ç­”ã‚’è¦‹ã‚‹';
                nextBtn.disabled = true;
                
            } catch (e) {
                console.log('å•é¡Œè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function showAnswer() {
            try {
                const question = allQuestions[currentQuestionIndex];
                const questionElement = document.getElementById('quizQuestion');
                const answerDisplay = document.getElementById('answerDisplay');
                const answerContent = document.getElementById('answerContent');
                const showAnswerBtn = document.getElementById('showAnswerBtn');
                const nextBtn = document.getElementById('quizNext');
                
                stopTimer();
                isQuizAnswered = true;
                
                const currentQuestionType = questionElement.dataset.questionType;
                
                let answerText = '';
                if (currentQuestionType === 'jp_to_en') {
                    answerText = question.en;
                } else {
                    answerText = question.jp;
                }
                
                let answerElement;
                if (currentQuestionType === 'jp_to_en' && answerText.match(/[a-zA-Z]/)) {
                    answerElement = addSpeakButton(answerText, document.createElement('div'));
                } else {
                    answerElement = document.createElement('div');
                    answerElement.textContent = answerText;
                }
                
                answerContent.innerHTML = '';
                
                const answerTextDiv = document.createElement('div');
                answerTextDiv.className = 'answer-text';
                answerTextDiv.appendChild(answerElement);
                
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'explanation-text';
                explanationDiv.textContent = question.explanation || 'è§£èª¬ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
                
                answerContent.appendChild(answerTextDiv);
                answerContent.appendChild(explanationDiv);
                
                answerDisplay.classList.add('show');
                
                if (currentQuestionType === 'jp_to_en' && answerText.match(/[a-zA-Z]/)) {
                    setTimeout(() => {
                        speakEnglishText(answerText);
                    }, 500);
                }
                
                showAnswerBtn.disabled = true;
                showAnswerBtn.textContent = 'âœ… è§£ç­”æ¸ˆã¿';
                nextBtn.disabled = false;
                
                studyCount++;
                document.getElementById('studyCount').textContent = studyCount;
                
                soundSystem.playStudyComplete();
                createParticle('â­', '#ff6b7d', window.innerWidth / 2, window.innerHeight / 3);

            } catch (e) {
                console.log('è§£ç­”è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function nextQuestion() {
            try {
                usedQuestions.push(currentQuestionIndex);
                
                if (questionMode === 'sequential') {
                    sequentialIndex++;
                }
                
                incrementClickCount();
                soundSystem.playClick();
                showNextQuestion();
                
            } catch (e) {
                console.log('æ¬¡ã®å•é¡Œã¸ã®ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function endQuiz() {
            try {
                hideAllModals();
                
                const gameScreen = document.getElementById('gameScreen');
                gameScreen.classList.remove('hidden');
                
                currentScreen = 'game';
                updateBackButton();
                
                resetQuizState();
                
            } catch (e) {
                console.log('ã‚¯ã‚¤ã‚ºçµ‚äº†å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- è¨­å®šé–¢æ•° ----------------- */
        function setTimerLimit(seconds) {
            try {
                timerLimit = seconds;
                
                document.querySelectorAll('.control-btn[data-time]').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (seconds === 'unlimited') {
                    document.getElementById('timerUnlimitedBtn').classList.add('active');
                } else {
                    document.getElementById(`timer${seconds}Btn`).classList.add('active');
                }
                
            } catch (e) {
                console.log('ã‚¿ã‚¤ãƒãƒ¼è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function setQuestionMode(mode) {
            try {
                questionMode = mode;
                
                document.querySelectorAll('.control-btn[data-mode]').forEach(btn => {
                    btn.classList.remove('active');
                });

                document.getElementById(`${mode}ModeBtn`).classList.add('active');
                
            } catch (e) {
                console.log('å•é¡Œãƒ¢ãƒ¼ãƒ‰è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function setQuestionDirection(direction) {
            try {
                questionDirection = direction;
                
                document.querySelectorAll('.control-btn[data-direction]').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (direction === 'jp_to_en') {
                    document.getElementById('jpToEnBtn').classList.add('active');
                } else if (direction === 'en_to_jp') {
                    document.getElementById('enToJpBtn').classList.add('active');
                } else {
                    document.getElementById('mixedBtn').classList.add('active');
                }
                
            } catch (e) {
                console.log('è¨€èªæ–¹å‘è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        /* ----------------- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ----------------- */
        function initEventListeners() {
            try {
                // å­¦å¹´é¸æŠãƒœã‚¿ãƒ³
                document.querySelectorAll('[data-grade]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const grade = e.currentTarget.dataset.grade;
                        currentGrade = grade;
                        hideAllModals();
                        
                        resetLessonSelections();
                        
                        const targetModal = document.getElementById(grade + 'Modal');
                        if (targetModal) {
                            targetModal.classList.add('show');
                        }
                        currentScreen = 'grade';
                        updateBackButton();
                    });
                });

                // ãƒ¬ãƒƒã‚¹ãƒ³é–‹å§‹ãƒœã‚¿ãƒ³
                ['1', '2', '3'].forEach(gradeNum => {
                    const startBtn = document.getElementById(`startMultipleLessons${gradeNum}`);
                    if (startBtn) {
                        startBtn.addEventListener('click', () => {
                            incrementClickCount();
                            soundSystem.playClick();
                            startSelectedLessons(`grade${gradeNum}`);
                        });
                    }
                });

                // æ–‡æ³•ã‚¯ã‚¤ã‚ºé–‹å§‹ãƒœã‚¿ãƒ³
                const startGrammarBtn = document.getElementById('startGrammarQuiz');
                if (startGrammarBtn) {
                    startGrammarBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        startGrammarQuiz();
                    });
                }

                // ã‚¯ã‚¤ã‚ºé–‹å§‹ãƒœã‚¿ãƒ³
                const startQuizBtn = document.getElementById('startQuizButton');
                if (startQuizBtn) {
                    startQuizBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        startQuiz();
                    });
                }

                // è§£ç­”è¡¨ç¤ºãƒœã‚¿ãƒ³
                const showAnswerBtn = document.getElementById('showAnswerBtn');
                if (showAnswerBtn) {
                    showAnswerBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        showAnswer();
                    });
                }

                // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³
                const nextBtn = document.getElementById('quizNext');
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        nextQuestion();
                    });
                }

                // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
                const footerHomeBtn = document.getElementById('footerHomeBtn');
                if (footerHomeBtn) {
                    footerHomeBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        goBackToMain();
                    });
                }

                const footerBackBtn = document.getElementById('footerBackBtn');
                if (footerBackBtn) {
                    footerBackBtn.addEventListener('click', () => {
                        goBack();
                    });
                }

                const footerVoiceBtn = document.getElementById('footerVoiceBtn');
                if (footerVoiceBtn) {
                    footerVoiceBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        openVoiceSettings();
                    });
                }

                // çµ±è¨ˆã‚¯ãƒªãƒƒã‚¯ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª
                const footerTotalStat = document.getElementById('footerTotalStat');
                if (footerTotalStat) {
                    footerTotalStat.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        confirmResetTotal();
                    });
                }

                const footerTodayStat = document.getElementById('footerTodayStat');
                if (footerTodayStat) {
                    footerTodayStat.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        confirmResetToday();
                    });
                }

                // éŸ³å£°ON/OFFåˆ‡ã‚Šæ›¿ãˆ
                const voiceEnabled = document.getElementById('voiceEnabled');
                if (voiceEnabled) {
                    voiceEnabled.addEventListener('change', toggleVoiceEnabled);
                }

                // ã‚¿ã‚¤ãƒãƒ¼è¨­å®šãƒœã‚¿ãƒ³
                document.querySelectorAll('.control-btn[data-time]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const time = btn.dataset.time;
                        setTimerLimit(time === 'unlimited' ? 'unlimited' : parseInt(time));
                    });
                });

                // å•é¡Œãƒ¢ãƒ¼ãƒ‰è¨­å®šãƒœã‚¿ãƒ³
                document.querySelectorAll('.control-btn[data-mode]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const mode = btn.dataset.mode;
                        setQuestionMode(mode);
                    });
                });

                // è¨€èªæ–¹å‘è¨­å®šãƒœã‚¿ãƒ³
                document.querySelectorAll('.control-btn[data-direction]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const direction = btn.dataset.direction;
                        setQuestionDirection(direction);
                    });
                });

                console.log('å…¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');

            } catch (e) {
                console.error('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ– ----------------- */
        function initLessonsAndGrammar() {
            try {
                console.log('ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–é–‹å§‹...');
                
                ['grade1', 'grade2', 'grade3'].forEach(grade => {
                    const container = document.getElementById(`${grade}Lessons`);
                    if (!container) {
                        console.error(`ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${grade}Lessons`);
                        return;
                    }
                    
                    console.log(`${grade}ã®ãƒ¬ãƒƒã‚¹ãƒ³æ•°: ${lessons[grade].length}`);
                    
                    lessons[grade].forEach(lesson => {
                        const btn = document.createElement('button');
                        btn.className = 'lesson-btn';
                        btn.innerHTML = lesson.name;
                        btn.setAttribute('data-lesson-id', lesson.id);
                        
                        btn.addEventListener('click', (e) => {
                            console.log('ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯:', lesson.id, lesson.name);
                            incrementClickCount();
                            soundSystem.playClick();
                            toggleLessonSelection(grade, lesson.id, lesson.name);
                            e.preventDefault();
                        });
                        
                        container.appendChild(btn);
                        console.log(`${grade} - ${lesson.id}ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ `);
                    });
                    
                    console.log(`${grade}ã®ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–å®Œäº†`);
                });
                
                console.log('å…¨ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–å®Œäº†');
                
            } catch (e) {
                console.error('ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        /* ----------------- ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ– ----------------- */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== ONE WORLD Quiz åˆæœŸåŒ–é–‹å§‹ï¼ˆJapaneseãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰ ===');
            
            try {
                console.log('1. problems.jsé€£æºãƒã‚§ãƒƒã‚¯é–‹å§‹');
                if (typeof problemDatabase !== 'undefined') {
                    console.log('âœ… problems.jsèª­ã¿è¾¼ã¿å®Œäº†');
                    console.log(`ğŸ“Š å•é¡Œãƒ‡ãƒ¼ã‚¿çµ±è¨ˆ: ${Object.keys(problemDatabase).length}é …ç›®`);
                    
                    ['grade1', 'grade2', 'grade3'].forEach(grade => {
                        const gradeProblems = Object.keys(problemDatabase).filter(key => key.startsWith(grade));
                        console.log(`${grade}: ${gradeProblems.length}é …ç›®`);
                    });
                } else {
                    console.warn('âš ï¸ problems.jsãŒã¾ã èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚é…å»¶èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œã—ã¾ã™ã€‚');
                    setTimeout(() => {
                        if (typeof problemDatabase !== 'undefined') {
                            console.log('âœ… problems.jsé…å»¶èª­ã¿è¾¼ã¿æˆåŠŸ');
                        } else {
                            console.error('âŒ problems.jsã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        }
                    }, 1000);
                }
                
                console.log('2. ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆèª­ã¿è¾¼ã¿é–‹å§‹');
                loadClickStats();
                console.log('âœ… ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆèª­ã¿è¾¼ã¿å®Œäº†');
                
                console.log('3. ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–é–‹å§‹');
                initLessonsAndGrammar();
                console.log('âœ… ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–å®Œäº†');
                
                console.log('4. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–é–‹å§‹');
                initEventListeners();
                console.log('âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–å®Œäº†');
                
                // éš ã—ã¦ãŠãã¹ãè¦ç´ 
                const gameScreen = document.getElementById('gameScreen');
                if (gameScreen) {
                    gameScreen.classList.add('hidden');
                }
                
                // åˆæœŸç”»é¢è¨­å®š
                currentScreen = 'main';
                updateBackButton();
                
                // åˆæœŸå€¤è¨­å®š
                setTimerLimit(3);
                setQuestionMode('random');
                setQuestionDirection('jp_to_en');
                
                resetLessonSelections();
                
                console.log('5. åˆæœŸè¨­å®šå®Œäº†');
                
                // éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®è¿½åŠ åˆæœŸåŒ–
                setTimeout(() => {
                    if (voiceSystem.voices.length === 0) {
                        console.log('éŸ³å£°å†åˆæœŸåŒ–å®Ÿè¡Œ');
                        voiceSystem.loadVoices();
                    }
                }, 2000);
                
                // éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®å†è©¦è¡Œãƒã‚§ãƒƒã‚¯
                setTimeout(() => {
                    const deviceInfo = voiceSystem.getDeviceInfo();
                    console.log('ğŸ¤ éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ æœ€çµ‚ãƒã‚§ãƒƒã‚¯:', deviceInfo);
                    if (deviceInfo.totalVoices === 0) {
                        console.warn('âš ï¸ éŸ³å£°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ‰‹å‹•ã§å†åˆæœŸåŒ–ã—ã¾ã™ã€‚');
                        voiceSystem.initializeVoices();
                    }
                }, 5000);
                
                console.log('=== åˆæœŸåŒ–å®Œäº†ï¼ˆJapaneseãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰ ===');
                console.log(`å­¦å¹´åˆ¥ãƒ¬ãƒƒã‚¹ãƒ³æ•°: 1å¹´ç”Ÿ=${lessons.grade1.length}, 2å¹´ç”Ÿ=${lessons.grade2.length}, 3å¹´ç”Ÿ=${lessons.grade3.length}`);
                console.log('ãƒ‡ãƒã‚¤ã‚¹è©³ç´°æƒ…å ±:', voiceSystem.getDeviceInfo());
                console.log('problems.jsé€£æº:', typeof problemDatabase !== 'undefined' ? 'âœ…æˆåŠŸ' : 'âŒå¤±æ•—');
                console.log('ğŸŒ Japaneseãƒ–ãƒ©ãƒ³ãƒ‰: ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ãƒ»ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œæˆ');
                
            } catch (error) {
                console.error('=== åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ ===', error);
                alert('åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
            }
        });

        /* ----------------- ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æƒ…å ± ----------------- */
        console.log('ONE WORLD Quiz ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†ï¼ˆJapaneseãƒ–ãƒ©ãƒ³ãƒ‰ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰');
        console.log('åˆ©ç”¨å¯èƒ½ãªå­¦å¹´:', Object.keys(lessons));
        console.log('å„å­¦å¹´ã®ãƒ¬ãƒƒã‚¹ãƒ³æ•°:', {
            grade1: lessons.grade1.length,
            grade2: lessons.grade2.length,
            grade3: lessons.grade3.length
        });

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.oneWorldQuizDebug = {
            lessons,
            problemDatabase: () => typeof problemDatabase !== 'undefined' ? problemDatabase : null,
            clickStats,
            selectedLessons,
            selectedGrammarItems,
            allQuestions,
            incrementClickCount,
            currentScreen,
            voiceSystem,
            soundSystem,
            resetLessonSelections,
            resetQuizState,
            testVoice: () => {
                console.log('éŸ³å£°ãƒ†ã‚¹ãƒˆé–‹å§‹');
                voiceSystem.speak("This is a premium Japanese brand voice test. Konnichiwa World!");
            },
            getDeviceInfo: () => voiceSystem.getDeviceInfo(),
            resetClickStats: () => {
                clickStats = { total: 0, daily: {} };
                saveClickStats();
                updateClickDisplays();
            },
            checkLessonButtons: () => {
                console.log('=== ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ãƒã‚§ãƒƒã‚¯ ===');
                ['grade1', 'grade2', 'grade3'].forEach(grade => {
                    const container = document.getElementById(`${grade}Lessons`);
                    const buttons = container ? container.querySelectorAll('.lesson-btn') : [];
                    console.log(`${grade}: ${buttons.length}å€‹ã®ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒœã‚¿ãƒ³`);
                    buttons.forEach((btn, index) => {
                        console.log(`  ${index + 1}. ID: ${btn.dataset.lessonId}, ãƒ†ã‚­ã‚¹ãƒˆ: ${btn.textContent.substring(0, 30)}...`);
                    });
                });
            },
            checkProblemsJs: () => {
                console.log('=== problems.jsè©³ç´°ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰ ===');
                if (typeof problemDatabase !== 'undefined') {
                    console.log(`âœ… problems.jsèª­ã¿è¾¼ã¿æ¸ˆã¿: ${Object.keys(problemDatabase).length}é …ç›®`);
                    
                    ['grade1', 'grade2', 'grade3'].forEach(grade => {
                        const gradeKeys = Object.keys(problemDatabase).filter(key => key.startsWith(grade));
                        console.log(`${grade}: ${gradeKeys.length}é …ç›®`);
                        gradeKeys.forEach(key => {
                            const problems = problemDatabase[key];
                            console.log(`  ${key}: ${problems ? problems.length : 0}å•`);
                        });
                    });
                } else {
                    console.error('âŒ problems.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
            },
            testLessonSelection: (grade, lessonId) => {
                console.log('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ†ã‚¹ãƒˆ:', grade, lessonId);
                const lesson = lessons[grade].find(l => l.id === lessonId);
                if (lesson) {
                    toggleLessonSelection(grade, lessonId, lesson.name);
                } else {
                    console.error('ãƒ¬ãƒƒã‚¹ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            },
            testSpecificVoice: (gender) => {
                console.log(`${gender}éŸ³å£°ãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰`);
                voiceSystem.testVoice(gender);
            },
            forceVoiceReload: () => {
                console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ å¼·åˆ¶å†èª­ã¿è¾¼ã¿ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ç‰ˆï¼‰');
                voiceSystem.initializeVoices();
            }
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.confirmResetTotal = confirmResetTotal;
        window.confirmResetToday = confirmResetToday;
        window.selectAndTestVoice = selectAndTestVoice;
        window.closeVoiceSettings = closeVoiceSettings;

    </script>
</body>
</html>